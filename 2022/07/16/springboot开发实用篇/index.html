

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/imgs/02.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="MFN">
  <meta name="keywords" content="">
  
    <meta name="description" content="SpringBoot开发实用篇热部署手动启动热部署项目做完某一个功能测试的时候，修改完功能可以马上见到效果 服务器发现程序有新的改动，服务器实现内部的重启 实现热部署，必须得在spring容器里添加配置 在pom文件中添加开发者工具并使用idea自带的重新构建项目完成热部署激活热备份(Ctrl+F9) 实际是idea重新启动了服务器  开启开发者工具  123456&lt;!--手动启动热部署--">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot开发实用篇">
<meta property="og:url" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/index.html">
<meta property="og:site_name" content="02的博客">
<meta property="og:description" content="SpringBoot开发实用篇热部署手动启动热部署项目做完某一个功能测试的时候，修改完功能可以马上见到效果 服务器发现程序有新的改动，服务器实现内部的重启 实现热部署，必须得在spring容器里添加配置 在pom文件中添加开发者工具并使用idea自带的重新构建项目完成热部署激活热备份(Ctrl+F9) 实际是idea重新启动了服务器  开启开发者工具  123456&lt;!--手动启动热部署--">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/1.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/2.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/3.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/4.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/5.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/6.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/7.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/8.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/9.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/10.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/11.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/12.png">
<meta property="og:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/13.png">
<meta property="article:published_time" content="2022-07-16T12:30:36.000Z">
<meta property="article:modified_time" content="2022-07-16T12:50:42.163Z">
<meta property="article:author" content="MFN">
<meta property="article:tag" content="springboot">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/1.png">
  
  
  
  <title>springboot开发实用篇 - 02的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Hello Myblog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="springboot开发实用篇"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-07-16 20:30" pubdate>
          星期六, 七月 16日 2022, 8:30 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          43k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          363 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">springboot开发实用篇</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="SpringBoot开发实用篇"><a href="#SpringBoot开发实用篇" class="headerlink" title="SpringBoot开发实用篇"></a>SpringBoot开发实用篇</h1><h2 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h2><h3 id="手动启动热部署"><a href="#手动启动热部署" class="headerlink" title="手动启动热部署"></a>手动启动热部署</h3><p>项目做完某一个功能测试的时候，修改完功能可以马上见到效果</p>
<p>服务器发现程序有新的改动，服务器实现内部的重启</p>
<p>实现热部署，必须得在spring容器里添加配置</p>
<p><strong>在pom文件中添加开发者工具并使用idea自带的重新构建项目完成热部署激活热备份(Ctrl+F9)</strong></p>
<p>实际是idea重新启动了服务器</p>
<ul>
<li>开启开发者工具</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--手动启动热部署--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>激活热部署</li>
</ul>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/1.png" srcset="/img/loading.gif" lazyload alt="idea构建项目"></p>
<h3 id="自动启动热部署"><a href="#自动启动热部署" class="headerlink" title="自动启动热部署"></a>自动启动热部署</h3><p>打开idea的自动构建项目  idea失去焦点五秒之后自动重新构建项目</p>
<p><strong><u>新版idea移除这个功能</u></strong></p>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/2.png" srcset="/img/loading.gif" lazyload alt="开启主动部署功能"></p>
<h3 id="关于热部署"><a href="#关于热部署" class="headerlink" title="关于热部署"></a>关于热部署</h3><ul>
<li>重启(Restart):自定义开发代码，包含类，页面，配置文件等，加载位置restart类加载器</li>
<li>重载(Reload):jar包，加载位置base类加载器</li>
</ul>
<p>热部署仅仅加载当前开发者自定义开发的资源，不加载jar资源</p>
<h4 id="热部署范围配置"><a href="#热部署范围配置" class="headerlink" title="热部署范围配置"></a>热部署范围配置</h4><ul>
<li>默认不触发重启的目录列表<ul>
<li>/META-INF/maven</li>
<li>/META-INF/resources</li>
<li>/resources</li>
<li>/static</li>
<li>/public</li>
<li>/templates</li>
</ul>
</li>
</ul>
<p>在springboot的配置文件中找到开发者工具，控制热部署范围配置</p>
<p>开发环境下有效</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">devtools:</span><br>  <span class="hljs-attr">restart:</span><br>    <span class="hljs-comment"># 设置不参与热部署的文件夹</span><br>    <span class="hljs-attr">exclude:</span> <span class="hljs-string">static/**,public/**,config/application.yml</span><br></code></pre></td></tr></table></figure>

<h4 id="关闭热部署"><a href="#关闭热部署" class="headerlink" title="关闭热部署"></a>关闭热部署</h4><h5 id="yml文件配置关闭"><a href="#yml文件配置关闭" class="headerlink" title="yml文件配置关闭"></a>yml文件配置关闭</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">devtools:</span><br>  <span class="hljs-attr">restart:</span><br>    <span class="hljs-comment"># 设置不参与热部署的文件夹</span><br>    <span class="hljs-attr">exclude:</span> <span class="hljs-string">static/**,public/**,config/application.yml</span><br>    <span class="hljs-comment"># 关闭热部署</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>

<h5 id="属性加载优先级覆盖关闭"><a href="#属性加载优先级覆盖关闭" class="headerlink" title="属性加载优先级覆盖关闭"></a>属性加载优先级覆盖关闭</h5><ul>
<li>设置高优先级属性禁用热部署</li>
</ul>
<p>在springboot启动入口类中设置关闭热部署</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SSMPApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.setProperty(<span class="hljs-string">&quot;spring.devtools.restart.enabled&quot;</span>,<span class="hljs-string">&quot;false&quot;</span>);<br>        SpringApplication.run(SSMPApplication.class, args);<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="配置高级"><a href="#配置高级" class="headerlink" title="配置高级"></a>配置高级</h2><h3 id="属性绑定"><a href="#属性绑定" class="headerlink" title="属性绑定"></a>属性绑定</h3><p><strong>configuration</strong></p>
<h4 id="三种属性绑定"><a href="#三种属性绑定" class="headerlink" title="三种属性绑定"></a>三种属性绑定</h4><h5 id="读取单一属性"><a href="#读取单一属性" class="headerlink" title="读取单一属性"></a>读取单一属性</h5><p>当要读取yml配置文件中country的值</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">country:</span> <span class="hljs-string">china</span><br><span class="hljs-attr">province:</span> <span class="hljs-string">beijing</span><br><span class="hljs-attr">city:</span> <span class="hljs-string">beijing</span><br><span class="hljs-attr">area:</span> <span class="hljs-string">haiding</span><br><br><span class="hljs-attr">user:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ma</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">16</span><br><br></code></pre></td></tr></table></figure>

<p>使用注解**@Value**获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;$&#123;country&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String country1;<br><br><span class="hljs-meta">@Value(&quot;$&#123;user.name&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String name1;<br></code></pre></td></tr></table></figure>

<p>像是是多级属性则一级一级读取</p>
<h5 id="读取数组中数据"><a href="#读取数组中数据" class="headerlink" title="读取数组中数据"></a>读取数组中数据</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">likes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">game</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">music</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">sleep</span><br></code></pre></td></tr></table></figure>

<p>同样是**@Value**获取 只不过是数组形式获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;$&#123;likes[1]&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String likes;<br></code></pre></td></tr></table></figure>

<h5 id="引用数据"><a href="#引用数据" class="headerlink" title="引用数据"></a>引用数据</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">baseDir:</span> <span class="hljs-string">c:\win10</span><br><span class="hljs-comment">#使用$&#123;属性名&#125;引用数据</span><br><span class="hljs-attr">tempDir:</span> <span class="hljs-string">$&#123;baseDir&#125;\temp</span><br><span class="hljs-comment">#使用引号包裹的字符串，其中的转义字符页可以生效</span><br><span class="hljs-attr">tempDir2:</span> <span class="hljs-string">&quot;$&#123;baseDir&#125;\temp \t1 \t2&quot;</span><br></code></pre></td></tr></table></figure>

<h5 id="读取yml全部属性数据"><a href="#读取yml全部属性数据" class="headerlink" title="读取yml全部属性数据"></a>读取yml全部属性数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//自动装配 yml配置文件里的全部属性</span><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> Environment env;<br></code></pre></td></tr></table></figure>

<p>获取数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(env.getProperty(<span class="hljs-string">&quot;user.name&quot;</span>));<br>System.out.println(env.getProperty(<span class="hljs-string">&quot;likes[1]&quot;</span>));<br></code></pre></td></tr></table></figure>

<h4 id="将一组数据封装为对象"><a href="#将一组数据封装为对象" class="headerlink" title="将一组数据封装为对象"></a>将一组数据封装为对象</h4><h5 id="配置数据"><a href="#配置数据" class="headerlink" title="配置数据"></a>配置数据</h5><p>在yml中配置数据</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">servers:</span><br>  <span class="hljs-attr">idAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">2345</span><br>  <span class="hljs-attr">timeout:</span> <span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure>

<p>定义实体类接收数据生成对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//定义数据模型封装yaml文件中对应的数据封装成对象</span><br><span class="hljs-comment">//定义spring管控的bean</span><br><span class="hljs-comment">//指定加载spring容器里自定义的bean</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span><br>/<span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String idAddress;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timeout;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="接收数据"><a href="#接收数据" class="headerlink" title="接收数据"></a>接收数据</h5><ul>
<li>在springboot启动入口测试 需要使用getBean来获得数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableConfigurationProperties(ServerConfig.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot10ConfigurationApplication</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span><br>    <span class="hljs-keyword">public</span> DruidDataSource <span class="hljs-title function_">druidDataSource</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br>        <span class="hljs-keyword">return</span> ds;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> SpringApplication.run(Springboot10ConfigurationApplication.class,args);<br>        <span class="hljs-type">ServerConfig</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> ctx.getBean(ServerConfig.class);<br><span class="hljs-comment">//        SpringApplication.run(Springboot10ConfigurationApplication.class, args);</span><br>        System.out.println(bean);<br>        <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> ctx.getBean(DruidDataSource.class);<br>        System.out.println(ds.getDriverClassName());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>在congtroller层使用注解**@Autowired**来获得数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> ServerConfig serverConfig;<br><br><span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>    System.out.println(serverfig)<br>    <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="第三方bean绑定"><a href="#第三方bean绑定" class="headerlink" title="第三方bean绑定"></a>第三方bean绑定</h4><p><strong>@ConfigurationProperties</strong>不仅适用于自定义的bean属性还适用于第三方bean绑定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span><br><span class="hljs-keyword">public</span> DruidDataSource <span class="hljs-title function_">druidDataSource</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br>    <span class="hljs-keyword">return</span> ds;<br>&#125;<br> System.out.println(ds.getDriverClassName());<br></code></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">datasource:</span><br>  <span class="hljs-attr">driverClassName:</span> <span class="hljs-string">com.mysql.jdbc.DriverMa</span><br></code></pre></td></tr></table></figure>

<h4 id="ConfigurationProperties和-EnableConfigurationProperties"><a href="#ConfigurationProperties和-EnableConfigurationProperties" class="headerlink" title="@ConfigurationProperties和@EnableConfigurationProperties"></a>@ConfigurationProperties和@EnableConfigurationProperties</h4><ul>
<li><p>开启属性绑定并设置具体目标**@EnableConfigurationProperties(ServerConfig.class)<strong>是指定一个类或者多个类为</strong>spring容器的bean<strong>跟</strong>@Component**作用大致相同 </p>
<ul>
<li>多个类的写法@EnableConfigurationProperties({A.class,b.Blass,C.class})</li>
<li>@EnableConfigurationProperties和@Component不能同时使用</li>
<li><strong>@Component：</strong> 标注Spring管理的Bean，使用@Component注解在一个类上，表示将此类标记为Spring容器中的一个Bean。</li>
</ul>
</li>
<li><p><strong>@ConfigurationProperties</strong>具体的做属性绑定</p>
</li>
</ul>
<h5 id="松散绑定"><a href="#松散绑定" class="headerlink" title="松散绑定"></a>松散绑定</h5><ul>
<li><strong>@ConfigurationProperties</strong>绑定属性支持绑定属性名宽松绑定</li>
<li><strong>@Value</strong> 不支持宽松绑定</li>
<li>绑定前缀命名命名规则——&gt;<strong>建议统一小写命名</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String idAddress;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timeout;<br>    <span class="hljs-comment">//默认时间单位为毫秒</span><br>    <span class="hljs-meta">@DurationUnit(ChronoUnit.HOURS)</span> <span class="hljs-comment">//自定义时间单位</span><br>    <span class="hljs-keyword">private</span> Duration serverTimeOut;<br>    <span class="hljs-comment">//数据存储单位</span><br>    <span class="hljs-meta">@DataSizeUnit(DataUnit.MEGABYTES)</span> <span class="hljs-comment">//自定义数据单位</span><br>    <span class="hljs-keyword">private</span> DataSize dataSize;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">servers:</span><br>  <span class="hljs-attr">idAddress:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>       <span class="hljs-comment"># 驼峰</span><br><span class="hljs-comment">#  ipaddress: 192.168.0.1</span><br><span class="hljs-comment">#  ip_address: 192.168.0.1      # unline</span><br><span class="hljs-comment">#  ip-address: 192.168.0.1       # 烤肉串格式 主流</span><br><span class="hljs-comment">#  IPADDRESS: 192.168.0.1</span><br><span class="hljs-comment">#  IP_ADDRESS: 192.168.0.1      # 常量</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">2345</span><br>  <span class="hljs-attr">timeout:</span> <span class="hljs-number">-1</span><br>  <span class="hljs-attr">serverTimeOut:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">dataSize:</span> <span class="hljs-number">10</span> <span class="hljs-comment"># 也可以写10MB</span><br></code></pre></td></tr></table></figure>

<h4 id="开启bean数据校验"><a href="#开启bean数据校验" class="headerlink" title="开启bean数据校验"></a>开启bean数据校验</h4><ul>
<li>添加JSR303规范坐标与hibernate校验框架坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--        1.导入JSR303规范--&gt;</span><br><span class="hljs-comment">&lt;!--        jdbc--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.validation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>validation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--        使用hibernate校验器做实现接口--&gt;</span><br><span class="hljs-comment">&lt;!--        mysql驱动--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.validator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>开启Bean校验功能 使用@Validated注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-comment">//2.开启对当前bean的属性注入校验</span><br><span class="hljs-meta">@Validated</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String idAddress;<br>    <span class="hljs-comment">//3.开启具体校验规则</span><br>    <span class="hljs-meta">@Max(value = 8888,message = &quot;最大值不超过8888&quot;)</span><br>    <span class="hljs-meta">@Min(value = 202,message = &quot;最小值不低于202&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timeout;<br>    <span class="hljs-comment">//默认时间单位为毫秒</span><br>    <span class="hljs-meta">@DurationUnit(ChronoUnit.HOURS)</span> <span class="hljs-comment">//自定义时间单位</span><br>    <span class="hljs-keyword">private</span> Duration serverTimeOut;<br>    <span class="hljs-comment">//数据存储单位</span><br>    <span class="hljs-meta">@DataSizeUnit(DataUnit.MEGABYTES)</span> <span class="hljs-comment">//自定义数据单位</span><br>    <span class="hljs-keyword">private</span> DataSize dataSize;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="进制转换规则"><a href="#进制转换规则" class="headerlink" title="进制转换规则"></a>进制转换规则</h4><p>yaml文件中对于数字的定义支持进制书写格式，如需使用字符串请使用引号明确标注</p>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/3.png" srcset="/img/loading.gif" lazyload alt="yaml语法规则"></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="加载测试环境专用属性"><a href="#加载测试环境专用属性" class="headerlink" title="加载测试环境专用属性"></a>加载测试环境专用属性</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">test:</span><br>  <span class="hljs-attr">prop:</span> <span class="hljs-string">vtb</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 配置临时变量属性 里面是数组类型可以添加多条</span><br><span class="hljs-comment">// properties 可以为当前属性添加一组临时属性配置</span><br><span class="hljs-comment">//@SpringBootTest(properties = &#123;&quot;test.prop=vtb1&quot;&#125;)</span><br><span class="hljs-comment">//使用args配置临时属性 模拟命令行模式 注意前面得加--</span><br><span class="hljs-comment">//@SpringBootTest(args = &#123;&quot;--test.prop=vtb2&quot;&#125;)</span><br><span class="hljs-comment">//当两个同时出现，由properties覆盖配置文件属性,再由命令行取代properties</span><br><span class="hljs-meta">@SpringBootTest(properties = &#123;&quot;test.prop=vtb1&quot;&#125;,args = &#123;&quot;--test.prop=vtb2&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesAndArgsTest</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String msg;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProperties</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(msg);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="引用外部资源"><a href="#引用外部资源" class="headerlink" title="引用外部资源"></a>引用外部资源</h4><ul>
<li>@Import(MsgConfig.class)可以导入bean</li>
<li>但是如果需要引用的类写了@Configuration 则springboot自动装配</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MsgConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">msg</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;bean msg&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@Import(MsgConfig.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span>  String msg;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">Configuration</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(msg);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="测试web层"><a href="#测试web层" class="headerlink" title="测试web层"></a>测试web层</h3><h4 id="模拟web环境"><a href="#模拟web环境" class="headerlink" title="模拟web环境"></a>模拟web环境</h4><ul>
<li><strong>@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</strong> 使用默认端口号进行访问</li>
</ul>
<p>模拟端口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">webTest</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="web环境模拟请求测试"><a href="#web环境模拟请求测试" class="headerlink" title="web环境模拟请求测试"></a>web环境模拟请求测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//设置web环境</span><br><span class="hljs-meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="hljs-comment">// 开启虚拟MVC调用</span><br><span class="hljs-meta">@AutoConfigureMockMvc</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebTest</span> &#123;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">webTest</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> MockMvc mvc)</span><span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//创建一个虚拟请求,当前访问/books</span><br>        <span class="hljs-type">MockHttpServletRequestBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> MockMvcRequestBuilders.get(<span class="hljs-string">&quot;/books&quot;</span>);<br>        <span class="hljs-comment">//执行对应请求</span><br>        mvc.perform(builder);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="虚拟请求响应状态匹配"><a href="#虚拟请求响应状态匹配" class="headerlink" title="虚拟请求响应状态匹配"></a>虚拟请求响应状态匹配</h4><ul>
<li>如果与预期值匹配相等则正常运行</li>
<li>如果不相等则报出详细错误</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">webTest</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> MockMvc mvc)</span><span class="hljs-keyword">throws</span> Exception&#123;<br>    <span class="hljs-comment">//创建一个虚拟请求,当前访问/books</span><br>    <span class="hljs-type">MockHttpServletRequestBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> MockMvcRequestBuilders.get(<span class="hljs-string">&quot;/books&quot;</span>);<br>    <span class="hljs-comment">//执行对应请求</span><br>    <span class="hljs-type">ResultActions</span> <span class="hljs-variable">actions</span> <span class="hljs-operator">=</span> mvc.perform(builder);<br>    <span class="hljs-comment">//设置预期值,与真实值进行比较,成功测试通过,失败测试失败\</span><br>    <span class="hljs-comment">//定义本次调用的预期值</span><br>    <span class="hljs-type">StatusResultMatchers</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> MockMvcResultMatchers.status();<br>    <span class="hljs-comment">//定义具体的结果 预计本次调用时成功的状态:200</span><br>    <span class="hljs-type">ResultMatcher</span> <span class="hljs-variable">ok</span> <span class="hljs-operator">=</span> status.isOk();<br>    <span class="hljs-comment">//添加预期值到本次调用过程中进行匹配</span><br>    actions.andExpect(ok);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/4.png" srcset="/img/loading.gif" lazyload alt="错误详情"></p>
<h4 id="测试响应体内容"><a href="#测试响应体内容" class="headerlink" title="测试响应体内容"></a>测试响应体内容</h4><ul>
<li>测试结果看返回值是否匹配<ul>
<li>成功则正常运行</li>
<li>失败则报出集团错误</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBody</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> MockMvc mvc)</span><span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//创建一个虚拟请求,当前访问/books</span><br>        <span class="hljs-type">MockHttpServletRequestBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> MockMvcRequestBuilders.get(<span class="hljs-string">&quot;/1books&quot;</span>);<br>        <span class="hljs-comment">//执行对应请求</span><br>        <span class="hljs-type">ResultActions</span> <span class="hljs-variable">actions</span> <span class="hljs-operator">=</span> mvc.perform(builder);<br><br><br>        <span class="hljs-comment">//设置预期值,与真实值进行比较,成功测试通过,失败测试失败</span><br>        <span class="hljs-comment">//定义本次调用的预期值</span><br>        <span class="hljs-type">ContentResultMatchers</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> MockMvcResultMatchers.content();<br>        <span class="hljs-comment">//定义具体的结果 预计本次调用时成功返回内容</span><br>        <span class="hljs-type">ResultMatcher</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> content.string(<span class="hljs-string">&quot;springboot&quot;</span>);<br>        <span class="hljs-comment">//添加预期值到本次调用过程中进行匹配</span><br>        actions.andExpect(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="测试响应体内容-JSON"><a href="#测试响应体内容-JSON" class="headerlink" title="测试响应体内容(JSON)"></a>测试响应体内容(JSON)</h4><ul>
<li>匹配Json返回内容是否和预期相等</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testBodyJson</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> MockMvc mvc)</span><span class="hljs-keyword">throws</span> Exception&#123;<br>    <span class="hljs-comment">//创建一个虚拟请求,当前访问/books</span><br>    <span class="hljs-type">MockHttpServletRequestBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> MockMvcRequestBuilders.get(<span class="hljs-string">&quot;/1books&quot;</span>);<br>    <span class="hljs-comment">//执行对应请求</span><br>    <span class="hljs-type">ResultActions</span> <span class="hljs-variable">actions</span> <span class="hljs-operator">=</span> mvc.perform(builder);<br><br><br>    <span class="hljs-comment">//设置预期值,与真实值进行比较,成功测试通过,失败测试失败</span><br>    <span class="hljs-comment">//定义本次调用的预期值</span><br>    <span class="hljs-type">ContentResultMatchers</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> MockMvcResultMatchers.content();<br>    <span class="hljs-comment">//定义具体的结果 预计本次调用时成功返回内容</span><br>    <span class="hljs-type">ResultMatcher</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> content.json(<span class="hljs-string">&quot;id1\n&quot;</span> +<br>            <span class="hljs-string">&quot;namespringboot\n&quot;</span> +<br>            <span class="hljs-string">&quot;typemath\n&quot;</span> +<br>            <span class="hljs-string">&quot;descriptiongood book&quot;</span>);<br>    <span class="hljs-comment">//添加预期值到本次调用过程中进行匹配</span><br>    actions.andExpect(result);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="测试响应头"><a href="#测试响应头" class="headerlink" title="测试响应头"></a>测试响应头</h4><ul>
<li>name中的value是否和预计的相同</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testContentType</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> MockMvc mvc)</span><span class="hljs-keyword">throws</span> Exception&#123;<br>    <span class="hljs-comment">//创建一个虚拟请求,当前访问/books</span><br>    <span class="hljs-type">MockHttpServletRequestBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> MockMvcRequestBuilders.get(<span class="hljs-string">&quot;/1books&quot;</span>);<br>    <span class="hljs-comment">//执行对应请求</span><br>    <span class="hljs-type">ResultActions</span> <span class="hljs-variable">actions</span> <span class="hljs-operator">=</span> mvc.perform(builder);<br><br><br>    <span class="hljs-comment">//设置预期值,与真实值进行比较,成功测试通过,失败测试失败</span><br>    <span class="hljs-comment">//定义本次调用的预期值</span><br>    <span class="hljs-type">HeaderResultMatchers</span> <span class="hljs-variable">header</span> <span class="hljs-operator">=</span> MockMvcResultMatchers.header();<br>    <span class="hljs-comment">//匹配响应头,name为响应头名称,value为预期结果</span><br>    <span class="hljs-type">ResultMatcher</span> <span class="hljs-variable">string</span> <span class="hljs-operator">=</span> header.string(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br>    <span class="hljs-comment">//添加预期值到本次调用过程中进行匹配</span><br>    actions.andExpect(string);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="数据层测试事务回滚"><a href="#数据层测试事务回滚" class="headerlink" title="数据层测试事务回滚"></a>数据层测试事务回滚</h3><ul>
<li>在测试数据的时候，在测试层添加**@Transactional** springboot会自动执行事务回滚，springboot知道是测试数据不将其写入数据库以免变成脏数据</li>
<li>如果需要数据插入到数据库加上注解**@Rollback(false)**,默认为true</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@Transactional</span> <span class="hljs-comment">//操作事务的注解</span><br><span class="hljs-meta">@Rollback</span> <span class="hljs-comment">//默认回滚 不将测试数据添加到数据库</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DaoTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> BookService bookService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">DaoTest</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>();<br><span class="hljs-comment">//        book.setId(1);</span><br>        book.setName(<span class="hljs-string">&quot;springboot&quot;</span>);<br>        book.setType(<span class="hljs-string">&quot;math&quot;</span>);<br>        book.setDescription(<span class="hljs-string">&quot;good book&quot;</span>);<br>        bookService.save(book);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="测试用例设置随机值"><a href="#测试用例设置随机值" class="headerlink" title="测试用例设置随机值"></a>测试用例设置随机值</h4><ul>
<li>在多环境配置中的测试环境添加测试随机值</li>
<li>通过创建实体封装为对象来接收</li>
<li>使用**@Autowired**注入bean来接收数据</li>
<li>设置范围没有规定使用哪种分隔符，()不唯一，可以使用各种符号分割，但不要使用 - 号</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">testcase:</span><br>  <span class="hljs-attr">book:</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-string">$&#123;random.int(10)&#125;</span> <span class="hljs-comment"># 设置范围 10以内</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">$&#123;random.value&#125;</span><br>    <span class="hljs-attr">uuid:</span> <span class="hljs-string">$&#123;random.uuid&#125;</span><br>    <span class="hljs-attr">publishTime:</span> <span class="hljs-string">$&#123;random.long&#125;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;testcase.book&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookCase</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String uuid;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> publishTime;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesAndArgsTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> BookCase bookCase;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProperties</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(bookCase);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="数据层解决方案SQL"><a href="#数据层解决方案SQL" class="headerlink" title="数据层解决方案SQL"></a>数据层解决方案SQL</h2><h3 id="现有数据层解决方案技术选型"><a href="#现有数据层解决方案技术选型" class="headerlink" title="现有数据层解决方案技术选型"></a>现有数据层解决方案技术选型</h3><p><strong>Druid+MyBatis-Plus+MySQL</strong></p>
<ul>
<li>数据源：DruidDataSource</li>
<li>持久化技术：MyBatis-Plus/MyBatis</li>
<li>数据库：MySQL</li>
</ul>
<h3 id="数据源内嵌配置"><a href="#数据源内嵌配置" class="headerlink" title="数据源内嵌配置"></a>数据源内嵌配置</h3><p>SpringBoot提供了三种内嵌的数据源对象共开发者选择</p>
<ul>
<li>HikariCP (springboot默认的配置)：默认内置数据源对象</li>
<li>Tomcat提供DataSource：HikariCP 不可用的情况下，且在web环境下，将使用tomcat服务器配置的数据源对象</li>
<li>Commons DBCP：HikariCP 不可用，tomcat数据源也不可用，将使用dbcp数据源</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment"># druid配置</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span>   <span class="hljs-comment"># 把druid禁用后 默认为Hikari配置</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/test</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nian0209</span><br>  <span class="hljs-comment"># Hikari配置 </span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/test</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nian0209</span><br></code></pre></td></tr></table></figure>

<h3 id="内置持久化解决方案-JdbcTemplate"><a href="#内置持久化解决方案-JdbcTemplate" class="headerlink" title="内置持久化解决方案-JdbcTemplate"></a>内置持久化解决方案-JdbcTemplate</h3><p>在不使用MyBatis/MyBatis-Plus的时候使用内置的JdbcTemlpate</p>
<ul>
<li><p>注意需要导入jdbc坐标</p>
</li>
<li><p>需要将mybatis相关配置关闭</p>
</li>
<li><p>jdbc依赖中携带了Hikari数据源依赖</p>
</li>
<li><p>可以在springboot配置文件中配置JdbcTemplate的相关配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/5.png" srcset="/img/loading.gif" lazyload alt="Hikari数据源依赖"></p>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/test</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">nian0209</span><br>  <span class="hljs-attr">jdbc:</span><br>    <span class="hljs-attr">template:</span><br>      <span class="hljs-attr">fetch-size:</span> <span class="hljs-number">-1</span>    <span class="hljs-comment"># 缓存行数</span><br>      <span class="hljs-attr">max-rows:</span> <span class="hljs-number">500</span>     <span class="hljs-comment"># 最大行数</span><br>      <span class="hljs-attr">query-timeout:</span> <span class="hljs-number">-1</span> <span class="hljs-comment"># 查询超时时间</span><br></code></pre></td></tr></table></figure>

<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcTemplateTest</span> &#123;<br><br>    <span class="hljs-comment">//由springboot容器注入JdbcTemplate数据源</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br>    <span class="hljs-comment">//查询 查询格式对于方法架构</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testJdbc</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from tbl_book where id =1&quot;</span>;<br>        List&lt;Book&gt; qurey = jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RowMapper</span>&lt;Book&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Book <span class="hljs-title function_">mapRow</span><span class="hljs-params">(ResultSet rs,<span class="hljs-type">int</span> rowNum)</span><span class="hljs-keyword">throws</span> SQLException&#123;<br>                <span class="hljs-type">Book</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>();<br>                temp.setId(rs.getInt(<span class="hljs-string">&quot;id&quot;</span>));<br>                temp.setName(rs.getString(<span class="hljs-string">&quot;name&quot;</span>));<br>                temp.setType(rs.getString(<span class="hljs-string">&quot;Type&quot;</span>));<br>                temp.setDescription(rs.getString(<span class="hljs-string">&quot;description&quot;</span>));<br>                <span class="hljs-keyword">return</span> temp;<br>            &#125;<br>        &#125;);<br>        System.out.println(qurey);<br>    &#125;<br>    <span class="hljs-comment">//添加操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Insert into tbl_book values(null,&#x27;1&#x27;,&#x27;2&#x27;&#x27;3&#x27;)&quot;</span>;<br>        jdbcTemplate.update(sql);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="内嵌数据库"><a href="#内嵌数据库" class="headerlink" title="内嵌数据库"></a>内嵌数据库</h3><ul>
<li>SpringBoot提供了三种内嵌数据库共开发者选择，提高开发测试效率<ul>
<li>H2</li>
<li>HSQL</li>
<li>Derby</li>
</ul>
</li>
</ul>
<p>三种数据库均是Java语言编写，可以在springboot环境中运行</p>
<ul>
<li>H2是内存数据库仅在开发阶段建议测试使用，上线后树妖将配置文件里H<strong>2下的enabled改为false</strong> 如何使用：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34845394/article/details/107190256"> H2数据库入门，看这篇就对了_不敲代码的攻城狮的博客-CSDN博客_h2数据库</a></li>
</ul>
<h2 id="NoSQL解决方案"><a href="#NoSQL解决方案" class="headerlink" title="NoSQL解决方案"></a>NoSQL解决方案</h2><ul>
<li>市面上常见的NoSQL解决方案<ul>
<li>Redis</li>
<li>Mongo</li>
<li>ES</li>
</ul>
</li>
</ul>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><ul>
<li>Redis是一款key-values存储结构的内存级NoSQL数据库<ul>
<li>支持多中数据存储格式</li>
<li>支持持久化</li>
<li>支持集群</li>
</ul>
</li>
</ul>
<h4 id="Redis基本安装-windows"><a href="#Redis基本安装-windows" class="headerlink" title="Redis基本安装(windows)"></a>Redis基本安装(windows)</h4><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis/releases">Releases · tporadowski/redis (github.com)</a></li>
<li>访问github下载windows版本的redis即可</li>
</ul>
<h4 id="Redis基本操作"><a href="#Redis基本操作" class="headerlink" title="Redis基本操作"></a>Redis基本操作</h4><ul>
<li>大型的哈希表 使用key-values形式</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/luna_a/article/details/107292994">Redis基本操作命令（图文详解）_进击小高的博客-CSDN博客_redis操作命令</a></li>
</ul>
<h5 id="第一次启动redis"><a href="#第一次启动redis" class="headerlink" title="第一次启动redis"></a>第一次启动redis</h5><ul>
<li>首先文件夹下cmd窗口运行 <strong>redis-server.exe  redis.windows.conf</strong> 运行服务器加指定配置</li>
<li>第一次运行会出现bug 运行出错<ul>
<li>所以得再另开一个cmd窗口 运行客户程序<strong>redis-cli.exe</strong>，输入shutdown 再exit退出即可</li>
<li>再重新运行 <strong>redis-server.exe  redis.windows.conf</strong> </li>
</ul>
</li>
<li>服务器启动</li>
<li>清除数据<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43845597/article/details/89631540"> 如何清理Redis中的缓存_灬文羽轩灬的博客-CSDN博客_redis缓存清理</a></li>
</ul>
</li>
</ul>
<h4 id="SpirngBoot整合Redis"><a href="#SpirngBoot整合Redis" class="headerlink" title="SpirngBoot整合Redis"></a>SpirngBoot整合Redis</h4><h5 id="1-导入Redis坐标"><a href="#1-导入Redis坐标" class="headerlink" title="1.导入Redis坐标"></a>1.导入Redis坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="2-在springboot配置文件中加入配置-可省略"><a href="#2-在springboot配置文件中加入配置-可省略" class="headerlink" title="2.在springboot配置文件中加入配置(可省略)"></a>2.在springboot配置文件中加入配置(可省略)</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br></code></pre></td></tr></table></figure>

<h5 id="3-注入redisTemplate对象-操作接口对象操作"><a href="#3-注入redisTemplate对象-操作接口对象操作" class="headerlink" title="3.注入redisTemplate对象 操作接口对象操作"></a>3.注入redisTemplate对象 操作接口对象操作</h5><h4 id="Redis-两种注入方法"><a href="#Redis-两种注入方法" class="headerlink" title="Redis 两种注入方法"></a>Redis 两种注入方法</h4><h5 id="客户端：RedisTemplate以对象作为key和value，内部对数据进行序列化"><a href="#客户端：RedisTemplate以对象作为key和value，内部对数据进行序列化" class="headerlink" title="客户端：RedisTemplate以对象作为key和value，内部对数据进行序列化"></a>客户端：RedisTemplate以对象作为key和value，内部对数据进行序列化</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot12RedisApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br><span class="hljs-comment">//    @Autowired</span><br><span class="hljs-comment">//    private StringRedisTemplate stringRedisTemplate;</span><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">ops</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue();<br>        <span class="hljs-type">HashOperations</span> <span class="hljs-variable">oph</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br>        ops.set(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">41</span>);<br>        oph.put(<span class="hljs-string">&quot;info&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;aa&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">get</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">ops</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue();<br>        <span class="hljs-type">HashOperations</span> <span class="hljs-variable">oph</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash();<br>        oph.get(<span class="hljs-string">&quot;info&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> ops.get(<span class="hljs-string">&quot;age&quot;</span>);<br>        System.out.println(age);<br>        System.out.println(oph);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="客户端StringRedisTemplate-常用-以字符串作为key和value，与Redis客户端操作等效"><a href="#客户端StringRedisTemplate-常用-以字符串作为key和value，与Redis客户端操作等效" class="headerlink" title="客户端StringRedisTemplate(常用)以字符串作为key和value，与Redis客户端操作等效"></a>客户端StringRedisTemplate(常用)以字符串作为key和value，与Redis客户端操作等效</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">sets</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> StringRedisTemplate stringRedisTemplate)</span>&#123;<br>    <span class="hljs-type">ValueOperations</span> <span class="hljs-variable">ops</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue();<br>    ops.set(<span class="hljs-string">&quot;testKey&quot;</span>,<span class="hljs-string">&quot;TestValue&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">gets</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> StringRedisTemplate stringRedisTemplate)</span>&#123;<br>    ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.opsForValue();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">testKey</span> <span class="hljs-operator">=</span> ops.get(<span class="hljs-string">&quot;testKey&quot;</span>);<br>    System.out.println(testKey);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="jedis客户端"><a href="#jedis客户端" class="headerlink" title="jedis客户端"></a>jedis客户端</h4><h5 id="1-导入jedis坐标"><a href="#1-导入jedis坐标" class="headerlink" title="1.导入jedis坐标"></a>1.导入jedis坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="2-设置client-type"><a href="#2-设置client-type" class="headerlink" title="2.设置client-type"></a>2.设置client-type</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">client-type:</span> <span class="hljs-string">jedis</span><br></code></pre></td></tr></table></figure>

<h4 id="客户端：lettcus-默认-与jedis区别"><a href="#客户端：lettcus-默认-与jedis区别" class="headerlink" title="客户端：lettcus(默认)与jedis区别"></a>客户端：lettcus(默认)与jedis区别</h4><ul>
<li><p>jedis连接Redis服务器是直连模式，当多线程模式下使用jedis会存在线程安全问题，解决方案可以通过配置连接池使每个连接专 用，这样整体性能就大受影响。</p>
</li>
<li><p>lettcus基于Netty框架进行与Redis服务器连接，底层设计中采用StatefulRedisConnection。 StatefulRedisConnection自身是线程安全的，可以保障并发访问安全问题，所以一个连接可以被多线程复用。当然lettcus也支持多连接实例一起工作</p>
</li>
</ul>
<h3 id="MangoDB"><a href="#MangoDB" class="headerlink" title="MangoDB"></a>MangoDB</h3><p>支持结构化的数据存储并且访问速度很快</p>
<ul>
<li><p>一个开源，高性能，<strong>无模式</strong>的<strong>文档型</strong>数据库。NoSQL数据库产品中的一种，是最像关系型数据库的非关系型数据库</p>
</li>
<li><p>存放的数据大多数是<strong>修改频率高</strong>，临时存储</p>
</li>
</ul>
<h4 id="Mongodb基本安装"><a href="#Mongodb基本安装" class="headerlink" title="Mongodb基本安装"></a>Mongodb基本安装</h4><ul>
<li><p>windows安装mongodb <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/community">MongoDB Community Download | MongoDB</a></p>
</li>
<li><p>解压缩后配置文件目录</p>
</li>
<li><p>windows下启动Mongo</p>
<ul>
<li>服务端启动：mongd –dbpath..\data\db</li>
<li>客户端启动：mongo (默认端口：27017 访问地址：127.0.0.1)</li>
</ul>
</li>
<li><p>使用navicat连接mongo数据库</p>
</li>
</ul>
<h4 id="Mongodb基本操作"><a href="#Mongodb基本操作" class="headerlink" title="Mongodb基本操作"></a>Mongodb基本操作</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/PILIpilipala/article/details/113818320"> 超级详细MongoDB 的基本操作(理论+举例)_11.28.的博客-CSDN博客</a></p>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/6.png" srcset="/img/loading.gif" lazyload alt="Mongdb操作"></p>
<h4 id="SpirngBoot整合MongDB"><a href="#SpirngBoot整合MongDB" class="headerlink" title="SpirngBoot整合MongDB"></a>SpirngBoot整合MongDB</h4><h5 id="1-导入对应坐标"><a href="#1-导入对应坐标" class="headerlink" title="1.导入对应坐标"></a>1.导入对应坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="2-配置mongodb数据库地址"><a href="#2-配置mongodb数据库地址" class="headerlink" title="2.配置mongodb数据库地址"></a>2.配置mongodb数据库地址</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">mongodb:</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://localhost/user</span><br></code></pre></td></tr></table></figure>

<h5 id="3-使用MongoTemplate接口客户端读写测试"><a href="#3-使用MongoTemplate接口客户端读写测试" class="headerlink" title="3.使用MongoTemplate接口客户端读写测试"></a>3.使用MongoTemplate接口客户端读写测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot13MongdbApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MongoTemplate mongoTemplate;<br><br>    <span class="hljs-comment">//插入</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>();<br>        book.setId(<span class="hljs-number">1</span>);<br>        book.setName(<span class="hljs-string">&quot;springboot&quot;</span>);<br>        book.setType(<span class="hljs-string">&quot;math&quot;</span>);<br>        book.setDescription(<span class="hljs-string">&quot;good book&quot;</span>);<br>        mongoTemplate.save(book);<br>    &#125;<br>    <br>    <span class="hljs-comment">//查询</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">find</span><span class="hljs-params">()</span>&#123;<br>        List&lt;Book&gt; all = mongoTemplate.findAll(Book.class);<br>        System.out.println(all);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Elasticesearch-ES"><a href="#Elasticesearch-ES" class="headerlink" title="Elasticesearch(ES)"></a>Elasticesearch(ES)</h3><ul>
<li>Elasticesearch是一个分布式全文搜索引擎</li>
</ul>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/7.png" srcset="/img/loading.gif" lazyload alt="多段索引"></p>
<h4 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h4><ul>
<li>创建/查询/删除索引<ul>
<li>PUT   <a target="_blank" rel="noopener" href="http://localhost:9200/books">http://localhost:9200/books</a></li>
<li>GET   <a target="_blank" rel="noopener" href="http://localhost:9200/books">http://localhost:9200/books</a></li>
<li>DELETE   <a target="_blank" rel="noopener" href="http://localhost:9200/books">http://localhost:9200/books</a></li>
</ul>
</li>
</ul>
<h4 id="添加ik分词器"><a href="#添加ik分词器" class="headerlink" title="添加ik分词器"></a>添加ik分词器</h4><p>将ik分词器解衣后存放在es目录下的plugins里</p>
<h4 id="创建索引并指定规则"><a href="#创建索引并指定规则" class="headerlink" title="创建索引并指定规则"></a>创建索引并指定规则</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yml">&#123;<br>        <span class="hljs-string">&quot;mappings&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;properties&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;id&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-string">:&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;name&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-string">:&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;analyzer&quot;</span><span class="hljs-string">:&quot;ik_max_word&quot;</span>,<br>        <span class="hljs-string">&quot;copy_to&quot;</span><span class="hljs-string">:&quot;all&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-string">:&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;decription&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-string">:&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;analyzer&quot;</span><span class="hljs-string">:&quot;ik_max_word&quot;</span>,<br>        <span class="hljs-string">&quot;copy_to&quot;</span><span class="hljs-string">:&quot;all&quot;</span><br>        &#125;,<br>        <span class="hljs-comment"># 设计型字段 将name和decription里的字段统一读入</span><br>        <span class="hljs-string">&quot;all&quot;</span><span class="hljs-string">:</span>&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-string">:&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;analyzer&quot;</span><span class="hljs-string">:&quot;ik_max_word&quot;</span><br>        &#125;<br>        &#125;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="创建文档"><a href="#创建文档" class="headerlink" title="创建文档"></a>创建文档</h4><p>PUT   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc">http://localhost:9200/books/_doc</a></p>
<h4 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h4><ul>
<li>查询文档：<ul>
<li>GET   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a>    查询单个</li>
<li>GET   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_search">http://localhost:9200/books/_search</a>   查询全部</li>
</ul>
</li>
<li>条件查询：GET   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_search">http://localhost:9200/books/_search</a> ?q=name:springboot(条件)</li>
</ul>
<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><ul>
<li>DELETE    <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a> </li>
</ul>
<h4 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h4><ul>
<li><p>全量修改</p>
<ul>
<li><p>PUT   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a></p>
<p>{</p>
<p>​        “name”:”springboot”,</p>
<p>​        ”type“:”springboot”,</p>
<p>​        “description”:”springboot”    </p>
<p>}</p>
</li>
</ul>
</li>
<li><p>部分修改</p>
<ul>
<li><p>POST   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_update/1">http://localhost:9200/books/_update/1</a></p>
<p>{</p>
<p>​        “doc”:{</p>
<p>​                        “name”:”springboot”,</p>
<p>​        }</p>
<p>}</p>
</li>
</ul>
</li>
</ul>
<h4 id="springboot整合ES"><a href="#springboot整合ES" class="headerlink" title="springboot整合ES"></a>springboot整合ES</h4><ul>
<li>因为视频中的方法以被springboot弃用，所以使用新的技术 在高版本的springboot中已经整合了High level client 可以使用注入bean来返回客户端</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gybshen/article/details/111469217">Spring Boot整合Elasticsearch，最新最全教程_Cloud-Future的博客-CSDN博客_springboot整合elasticsearch</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45721467/article/details/107990031"> SpringBoot 整合 high-level-client_张凯生的博客-CSDN博客</a></p>
<h2 id="整合第三方技术"><a href="#整合第三方技术" class="headerlink" title="整合第三方技术"></a>整合第三方技术</h2><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><ul>
<li><p>缓存是一种介于数据永久存储介质与属于应用之间的数据临时存储介质</p>
</li>
<li><p>使用缓存可以有效的减少低速数据读取过程的次数(例如：磁盘IO)，提高系统性能</p>
</li>
<li><p>缓存不仅可以用于提高永久性存储介质的数据读取效率，还可以提高临时的数据存储空间</p>
</li>
</ul>
<h4 id="模拟缓存"><a href="#模拟缓存" class="headerlink" title="模拟缓存"></a>模拟缓存</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//模拟缓存</span><br><span class="hljs-keyword">private</span> HashMap&lt;Integer,Book&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Book <span class="hljs-title function_">getById</span><span class="hljs-params">(Integer id)</span> &#123;<br>    <span class="hljs-comment">//如果当前缓存中没有本次查询的数据，则在数据库中进行查询，否则直接在缓存中读取返回</span><br>    <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> cache.get(id);<br>    <span class="hljs-keyword">if</span> (book==<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-type">Book</span> <span class="hljs-variable">queryBook</span> <span class="hljs-operator">=</span> bookDao.selectById(id);<br>        cache.put(id,queryBook);<br>        <span class="hljs-keyword">return</span> queryBook;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cache.get(id);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Springboot提高了缓存技术，方便缓存使用"><a href="#Springboot提高了缓存技术，方便缓存使用" class="headerlink" title="Springboot提高了缓存技术，方便缓存使用"></a>Springboot提高了缓存技术，方便缓存使用</h4><h5 id="启用缓存"><a href="#启用缓存" class="headerlink" title="启用缓存"></a>启用缓存</h5><ul>
<li>导入缓存依赖坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--cache--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>在springboot启动程序入口设置启用缓存 注解 <strong>@EnableCaching</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">// 开启缓存功能</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot15CacheApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(Springboot15CacheApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>在需要使用缓存的地方设置开启缓存功能 <strong>@Cacheable</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-comment">//开启缓存，缓存空间为cacheSpace，查找条件为key=id</span><br><span class="hljs-meta">@Cacheable(value = &quot;cacheSpace&quot;,key =&quot;#id&quot;)</span><br><span class="hljs-keyword">public</span> Book <span class="hljs-title function_">getById</span><span class="hljs-params">(Integer id)</span> &#123;<br>    <span class="hljs-keyword">return</span> bookDao.selectById(id);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="Springboot-提供的缓存技术除了默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存的开发与管理"><a href="#Springboot-提供的缓存技术除了默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存的开发与管理" class="headerlink" title="Springboot 提供的缓存技术除了默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存的开发与管理"></a>Springboot 提供的缓存技术除了默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存的开发与管理</h5><ul>
<li>Generic</li>
<li>JCache</li>
<li>Ehcache</li>
<li>Hazelacst</li>
<li>infinispan</li>
<li>Coushbase</li>
<li>Redis</li>
<li>Caffenine</li>
<li>Simple(默认)</li>
<li>memcached(市面上，常用的缓存技术)</li>
</ul>
<h5 id="缓存使用案例—手机验证码"><a href="#缓存使用案例—手机验证码" class="headerlink" title="缓存使用案例—手机验证码"></a>缓存使用案例—手机验证码</h5><ul>
<li>需求<ul>
<li>输入手机号获取验证码，组织文档以短信形式发送给用户(页面模拟)</li>
<li>输入手机号和验证码验证结果</li>
</ul>
</li>
</ul>
<ul>
<li>需求分析<ul>
<li>提供controller，传入手机号，业务层通过手机号计算出独有的六位验证码数据，存入缓存后返回此数据</li>
<li>提供controller，传入手机号与验证码，业务层通过手机号从缓存中读取验证码与输入的验证码进行比对</li>
</ul>
</li>
</ul>
<h3 id="springboot整合ehcache缓存"><a href="#springboot整合ehcache缓存" class="headerlink" title="springboot整合ehcache缓存"></a>springboot整合ehcache缓存</h3><p>导入坐标依赖</p>
<ul>
<li>注意springboot的版本稳定为2.5.x</li>
<li>添加ehcache配置文件</li>
<li>在springboot的配置文件中配置ehcache</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sf.ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:noNamespaceSchemaLocation</span>=<span class="hljs-string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">updateCheck</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">diskStore</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;D:\ehcache&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!--默认缓存策略 --&gt;</span><br>    <span class="hljs-comment">&lt;!-- external：是否永久存在，设置为true则不会被清除，此时与timeout冲突，通常设置为false--&gt;</span><br>    <span class="hljs-comment">&lt;!-- diskPersistent：是否启用磁盘持久化--&gt;</span><br>    <span class="hljs-comment">&lt;!-- maxElementsInMemory：最大缓存数量--&gt;</span><br>    <span class="hljs-comment">&lt;!-- overflowToDisk：超过最大缓存数量是否持久化到磁盘--&gt;</span><br>    <span class="hljs-comment">&lt;!-- timeToIdleSeconds：最大不活动间隔，设置过长缓存容易溢出，设置过短无效果，可用于记录时效性数据，例如验证码--&gt;</span><br>    <span class="hljs-comment">&lt;!-- timeToLiveSeconds：最大存活时间--&gt;</span><br>    <span class="hljs-comment">&lt;!-- memoryStoreEvictionPolicy：缓存清除策略--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">defaultCache</span></span><br><span class="hljs-tag">        <span class="hljs-attr">eternal</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">diskPersistent</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">&quot;1000&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">&quot;60&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">&quot;60&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">&quot;LRU&quot;</span> /&gt;</span><br>	<br>    <span class="hljs-comment">&lt;!-- 添加其他缓存策略--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span></span><br><span class="hljs-tag">        <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;smsCode&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">eternal</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">diskPersistent</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">&quot;1000&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">&quot;10&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">&quot;10&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">&quot;LRU&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment"># 缓存技术选择</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">ehcache</span><br>    <span class="hljs-attr">ehcache:</span><br>      <span class="hljs-attr">config:</span> <span class="hljs-string">classpath:ehcache.xml</span><br></code></pre></td></tr></table></figure>

<h3 id="转换缓存方案为Redis"><a href="#转换缓存方案为Redis" class="headerlink" title="转换缓存方案为Redis"></a>转换缓存方案为Redis</h3><p>springboot中切换缓存方案为Redis</p>
<ul>
<li>导入依赖</li>
<li>在springboot的配置文件中配置Redis相关内容</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>  <span class="hljs-comment"># 缓存技术选择 redis配置 需要开redis服务器</span><br>  <span class="hljs-attr">cache:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-comment"># 是否缓存空值</span><br>      <span class="hljs-attr">cache-null-values:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># 是否使用前缀 开启false之后 key-prefix的配置不起作用</span><br>      <span class="hljs-attr">use-key-prefix:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># 指定前缀</span><br>      <span class="hljs-attr">key-prefix:</span> <span class="hljs-string">aa</span><br>      <span class="hljs-comment"># 最大活动时间</span><br>      <span class="hljs-attr">time-to-live:</span> <span class="hljs-string">10s</span><br></code></pre></td></tr></table></figure>

<h3 id="memchaed-需要重新配置-window下安装有问题"><a href="#memchaed-需要重新配置-window下安装有问题" class="headerlink" title="memchaed 需要重新配置 window下安装有问题"></a>memchaed 需要重新配置 window下安装有问题</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ringbug/p/15595371.html">memcached 安装及集成(转) - Jsonring - 博客园 (cnblogs.com)</a></p>
<h3 id="缓存供应商变更jetcache"><a href="#缓存供应商变更jetcache" class="headerlink" title="缓存供应商变更jetcache"></a>缓存供应商变更jetcache</h3><ul>
<li><p>jetCache对SpringCache进行了封装，在原有功能的基础上实现了多级缓存，缓存统计，自动刷新，异步调用，数据报表等功能</p>
</li>
<li><p>jetCache设定了本地缓存与远程缓存的多级缓存解决方案</p>
<ul>
<li>本地缓存(local)<ul>
<li>LinkedHashMap</li>
<li>Caffeine</li>
</ul>
</li>
<li>远程缓存(remote)<ul>
<li>Redis</li>
<li>Tair</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="加入坐标依赖"><a href="#加入坐标依赖" class="headerlink" title="加入坐标依赖"></a>加入坐标依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alicp.jetcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jetcache-starter-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="本地缓存也远程缓存共存"><a href="#本地缓存也远程缓存共存" class="headerlink" title="本地缓存也远程缓存共存"></a>本地缓存也远程缓存共存</h4><ul>
<li>remote</li>
<li>local</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">jetcache:</span><br>  <span class="hljs-attr">local:</span><br>  	<span class="hljs-comment"># 默认</span><br>    <span class="hljs-attr">default:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">linkedhashmap</span><br>      <span class="hljs-attr">keyConvertor:</span> <span class="hljs-string">fastjson</span><br>  <span class="hljs-attr">remote:</span><br>  	<span class="hljs-comment"># 默认</span><br>    <span class="hljs-attr">default:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">poolConfig:</span><br>        <span class="hljs-attr">maxTotal:</span> <span class="hljs-number">50</span><br>    <span class="hljs-comment"># 远程配置2</span><br>    <span class="hljs-attr">sms:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">poolConfig:</span><br>        <span class="hljs-attr">maxTotal:</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure>

<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/8.png" srcset="/img/loading.gif" lazyload alt="基本配置"></p>
<h4 id="开启使用jetCache-注解：-EnableCreateCacheAnnotation"><a href="#开启使用jetCache-注解：-EnableCreateCacheAnnotation" class="headerlink" title="开启使用jetCache 注解：**@EnableCreateCacheAnnotation**"></a>开启使用jetCache 注解：**@EnableCreateCacheAnnotation**</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//jetcache启用缓存的主开关</span><br><span class="hljs-meta">@EnableCreateCacheAnnotation</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot16JetcacheApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(Springboot16JetcacheApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="声明缓存对象"><a href="#声明缓存对象" class="headerlink" title="声明缓存对象"></a>声明缓存对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SMSCodeServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SMSCodeService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CodeUtils codeUtils;<br><br>    <span class="hljs-comment">// remote</span><br><br>    <span class="hljs-comment">// 设置过期时间 默认为秒 设置本地访问:cacheType = CacheType.LOCAL</span><br>    <span class="hljs-meta">@CreateCache(name=&quot;jetCache&quot;,expire = 3600,timeUnit =  TimeUnit.SECONDS,cacheType = CacheType.LOCAL)</span><br>    <span class="hljs-keyword">private</span> Cache&lt;String,String&gt; jetCache;<br><br>    <span class="hljs-comment">// 设置过期时间 默认为秒  方案2</span><br><span class="hljs-comment">//    @CreateCache(area = &quot;sms&quot;,name=&quot;jetCache&quot;,expire = 10,timeUnit =  TimeUnit.SECONDS)</span><br><span class="hljs-comment">//    private Cache&lt;String,String&gt; jetCache1;</span><br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendCodeToSMS</span><span class="hljs-params">(String tele)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> codeUtils.generator(tele);<br>        jetCache.put(tele,code);<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkCode</span><span class="hljs-params">(SMSCode smsCode)</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> jetCache.get(smsCode.getTele());<br>        <span class="hljs-keyword">return</span> smsCode.getCode().equals(code);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="启用方法注解"><a href="#启用方法注解" class="headerlink" title="启用方法注解"></a>启用方法注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//jetcache启用缓存的主开关</span><br><span class="hljs-meta">@EnableCreateCacheAnnotation</span><br><span class="hljs-comment">//开启方法注解缓存 在方法头上设置开启缓存 指定扫描的包</span><br><span class="hljs-meta">@EnableMethodCache(basePackages = &quot;ithima&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot16JetcacheApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(Springboot16JetcacheApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h5><ul>
<li>缓存对象必须保障可序列话</li>
<li>设置编码</li>
<li>设置增删查改的缓存操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String type;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String description;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">jetcache:</span><br>  <span class="hljs-comment"># 查看缓存统计报告</span><br>  <span class="hljs-attr">statIntervaMinutes:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">local:</span><br>    <span class="hljs-attr">default:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">linkedhashmap</span><br>      <span class="hljs-attr">keyConvertor:</span> <span class="hljs-string">fastjson</span><br>  <span class="hljs-attr">remote:</span><br>    <span class="hljs-attr">default:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">keyConvertor:</span> <span class="hljs-string">fastjson</span><br>      <span class="hljs-attr">valueEncode:</span> <span class="hljs-string">java</span><br>      <span class="hljs-attr">valueDecode:</span> <span class="hljs-string">java</span><br>      <span class="hljs-attr">poolConfig:</span><br>        <span class="hljs-attr">maxTotal:</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;BookDao, Book&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> BookDao bookDao;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">//开启缓存，缓存空间为cacheSpace，查找条件为key=id 设置为本地</span><br>    <span class="hljs-meta">@Cached(name=&quot;book_&quot;,key=&quot;#id&quot;,expire = 3600,cacheType = CacheType.REMOTE)</span><br>    <span class="hljs-meta">@CacheRefresh(refresh = 10,timeUnit = TimeUnit.SECONDS)</span><br>    <span class="hljs-keyword">public</span> Book <span class="hljs-title function_">getById</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> bookDao.selectById(id);<br>    &#125;<br>    <span class="hljs-comment">//更新操作 更新时将缓存中对应的数据一起更新</span><br>    <span class="hljs-meta">@CacheUpdate(name=&quot;book_&quot;,key=&quot;#book.id&quot;,value=&quot;#book&quot;)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Book book)</span> &#123;<br>        <span class="hljs-keyword">return</span> bookDao.updateById(book)&gt;<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-comment">//删除操作 删除时将缓存中对应的数据一起删除</span><br>    <span class="hljs-meta">@CacheInvalidate(name = &quot;book_&quot;,key=&quot;#id&quot;)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> bookDao.deleteById(id)&gt;<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="缓存供应商变更：j2cache"><a href="#缓存供应商变更：j2cache" class="headerlink" title="缓存供应商变更：j2cache"></a>缓存供应商变更：j2cache</h3><ul>
<li>j2cache是一个缓存整合框架，可以提供缓存的整合方案，使各种缓存搭配使用，自身并不提供缓存功能</li>
<li>基于ebcache+redis进行整合</li>
</ul>
<h4 id="添加坐标"><a href="#添加坐标" class="headerlink" title="添加坐标"></a>添加坐标</h4><ul>
<li>加入整合坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--j2cache核心坐标--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.j2cache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>j2cache-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.5-release<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--springboot整合j2cache坐标--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.j2cache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>j2cache-spring-boot2-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.0-release<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--整合ehcache，使用其他就换其他坐标--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sf.ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="在springboot配置文件中设置j2cache的配置文件"><a href="#在springboot配置文件中设置j2cache的配置文件" class="headerlink" title="在springboot配置文件中设置j2cache的配置文件"></a>在springboot配置文件中设置j2cache的配置文件</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">j2cache:</span><br>  <span class="hljs-attr">config-location:</span> <span class="hljs-string">j2cache.properties</span><br></code></pre></td></tr></table></figure>

<h4 id="配置一级缓存和二级缓存以及一级缓存数据到二级缓存的发送方式"><a href="#配置一级缓存和二级缓存以及一级缓存数据到二级缓存的发送方式" class="headerlink" title="配置一级缓存和二级缓存以及一级缓存数据到二级缓存的发送方式"></a>配置一级缓存和二级缓存以及一级缓存数据到二级缓存的发送方式</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 1级缓存</span><br><span class="hljs-comment"># 配置供应商</span><br><span class="hljs-attr">j2cache.L1.provider_class</span> = <span class="hljs-string">ehcache</span><br><span class="hljs-attr">ehcache.configXml</span> = <span class="hljs-string">ehcache.xml</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 设置是否启用二级缓存</span><br><span class="hljs-attr">j2cache-l2-open</span> = <span class="hljs-string">false</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 2级缓存</span><br><span class="hljs-comment"># 配置供应商</span><br><span class="hljs-attr">j2cache.L2.provider_class</span> = <span class="hljs-string">net.oschina.j2cache.cache.support.redis.SpringRedisProvider</span><br><span class="hljs-attr">j2cache.L2.config_section</span> = <span class="hljs-string">redis</span><br><span class="hljs-attr">redis.hosts</span> = <span class="hljs-string">localhost:6379</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 1级缓存中的数据如何到达二级缓存中</span><br><span class="hljs-comment"># 配置一级缓存数据到二级缓存数据的广播方式：可以使用redis提供的消息订阅模式，也可以使用groups 多播实现</span><br><span class="hljs-attr">j2cache.broadcast</span> =<span class="hljs-string">net.oschina.j2cache.cache.support.redis.SpringRedisPubSubPolicy</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 配置redis模式</span><br><span class="hljs-attr">redis.mode</span> = <span class="hljs-string">single</span><br></code></pre></td></tr></table></figure>

<h4 id="设置缓存对象，操作数据"><a href="#设置缓存对象，操作数据" class="headerlink" title="设置缓存对象，操作数据"></a>设置缓存对象，操作数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SMSCodeServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SMSCodeService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CodeUtils codeUtils;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CacheChannel cacheChannel;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendCodeToSMS</span><span class="hljs-params">(String tele)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> codeUtils.generator(tele);<br>        cacheChannel.set(<span class="hljs-string">&quot;sms&quot;</span>,tele,code);<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkCode</span><span class="hljs-params">(SMSCode smsCode)</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> cacheChannel.get(<span class="hljs-string">&quot;sms&quot;</span>,smsCode.getTele()).asString();<br>        <span class="hljs-keyword">return</span> smsCode.getCode().equals(code);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h2><ul>
<li><p>定时任务是企业级应用中的常见操作</p>
<ul>
<li>年度报表</li>
<li>缓存统计报告</li>
<li>… …</li>
</ul>
</li>
<li><p>市面上流行的定时任务技术</p>
<ul>
<li>Quartz</li>
<li>Spring Task</li>
</ul>
</li>
</ul>
<h3 id="Springboot-整合Quartz"><a href="#Springboot-整合Quartz" class="headerlink" title="Springboot 整合Quartz"></a>Springboot 整合Quartz</h3><ul>
<li>相关概念<ul>
<li>工作(Job):用于定义具体执行的工作</li>
<li>工作明细(JobDetail):用于描述定时工作相关的信息</li>
<li>触发器(Trigger):用于描述工作的规则，通常使用cron表达定义调度规则</li>
<li>调度器(Scheduler):描述工作明细与触发器的对应关系</li>
</ul>
</li>
</ul>
<h4 id="导入对应坐标"><a href="#导入对应坐标" class="headerlink" title="导入对应坐标"></a>导入对应坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="定义具体要执行的任务"><a href="#定义具体要执行的任务" class="headerlink" title="定义具体要执行的任务"></a>定义具体要执行的任务</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyQuartz</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">QuartzJobBean</span> &#123;<br>    <span class="hljs-comment">// 具体要做的事</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeInternal</span><span class="hljs-params">(JobExecutionContext jobExecutionContext)</span> <span class="hljs-keyword">throws</span> JobExecutionException &#123;<br><br>        System.out.println(<span class="hljs-string">&quot;Quartz job is running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="定义工作明细与触发器，并绑定对应关系"><a href="#定义工作明细与触发器，并绑定对应关系" class="headerlink" title="定义工作明细与触发器，并绑定对应关系"></a>定义工作明细与触发器，并绑定对应关系</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuartzConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> JobDetail <span class="hljs-title function_">printJobDetail</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//绑定具体工作</span><br>        <span class="hljs-keyword">return</span> JobBuilder.newJob(MyQuartz.class).storeDurably().build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Trigger <span class="hljs-title function_">printTrigger</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//绑定具体的工作明显</span><br>        ScheduleBuilder&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Trigger</span>&gt; schedBuilder = CronScheduleBuilder.cronSchedule(<span class="hljs-string">&quot;0/5 * * * * ?&quot;</span>);<br>        <span class="hljs-keyword">return</span> TriggerBuilder.newTrigger().forJob(printJobDetail()).withSchedule(schedBuilder).build();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="spring-task"><a href="#spring-task" class="headerlink" title="spring task"></a>spring task</h3><h4 id="设置开启定时任务功能开关"><a href="#设置开启定时任务功能开关" class="headerlink" title="设置开启定时任务功能开关"></a>设置开启定时任务功能开关</h4><ul>
<li>在springboot启动类入口使用注解 <strong>@EnableScheduling</strong> </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//开启定时任务功能</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">springboot18TaskApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(springboot18TaskApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="设置定时执行的任务"><a href="#设置定时执行的任务" class="headerlink" title="设置定时执行的任务"></a>设置定时执行的任务</h4><ul>
<li>在方法上直接使用注解来指定要定时执行的任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBean</span> &#123;<br><br>    <span class="hljs-comment">//设置执行时间</span><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0/3 * * * * ?&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;spring task is running.....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>设置spring task线程前缀</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">task:</span><br>    <span class="hljs-attr">execution:</span><br>      <span class="hljs-attr">thread-name-prefix:</span> <span class="hljs-string">spring_task_</span><br></code></pre></td></tr></table></figure>

<h3 id="springboot-整合JavaMail"><a href="#springboot-整合JavaMail" class="headerlink" title="springboot 整合JavaMail"></a>springboot 整合JavaMail</h3><h4 id="发送简单邮件"><a href="#发送简单邮件" class="headerlink" title="发送简单邮件"></a>发送简单邮件</h4><ul>
<li>SMTP(Simple Mail Transfer Protocol):简单邮件传输协议，用于发送电子邮件的传输协议</li>
<li>POP3(Post Office Protocol -Version3):用于接收电子邮件的标准协议</li>
<li>IMAP(Internet Mail Access Protocol):互联网消息协议，是POP3的替代协议</li>
</ul>
<h5 id="导入对应Javamail坐标"><a href="#导入对应Javamail坐标" class="headerlink" title="导入对应Javamail坐标"></a>导入对应Javamail坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="配置smtp协议POP3协议"><a href="#配置smtp协议POP3协议" class="headerlink" title="配置smtp协议POP3协议"></a>配置smtp协议POP3协议</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mail:</span><br>    <span class="hljs-comment"># 邮件服务器供应商</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">smtp.qq.com</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-number">2976908</span><span class="hljs-string">***@qq.com</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">xxuchqhavybxde**</span><br></code></pre></td></tr></table></figure>

<h5 id="设置邮件客户端"><a href="#设置邮件客户端" class="headerlink" title="设置邮件客户端"></a>设置邮件客户端</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SendMailService</span> &#123;<br><br>    <span class="hljs-comment">//发送人</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">from</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;2976908***@qq.com&quot;</span>;<br>    <span class="hljs-comment">//接收人</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">to</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;129577****@qq.com&quot;</span>;<br>    <span class="hljs-comment">//标题</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;测试邮件&quot;</span>;<br>    <span class="hljs-comment">//测试邮件正文</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;测试邮件正文内容&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JavaMailSender javaMailSender;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMail</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-type">SimpleMailMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMailMessage</span>();<br>        message.setFrom(from);<br>        message.setTo(to);<br>        message.setSubject(subject);<br>        message.setText(context);<br>        javaMailSender.send(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="发送复杂邮件"><a href="#发送复杂邮件" class="headerlink" title="发送复杂邮件"></a>发送复杂邮件</h4><ul>
<li>使用MimeMessageHelper对象</li>
<li>发送html 需要开启 helper.setText(context,true);</li>
<li>发送附件MimeMessageHelper(message,true);</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SendMailService</span> &#123;<br><br>    <span class="hljs-comment">//发送人</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">from</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;2976908894@qq.com&quot;</span>;<br>    <span class="hljs-comment">//接收人</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">to</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1295773125@qq.com&quot;</span>;<br>    <span class="hljs-comment">//标题</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;测试邮件&quot;</span>;<br>    <span class="hljs-comment">//测试邮件正文</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&lt;a href=&#x27;https://lulyqqqq.github.io/&#x27;&gt;博客&lt;/a&gt;&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JavaMailSender javaMailSender;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMail</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">MimeMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> javaMailSender.createMimeMessage();<br>            <span class="hljs-type">MimeMessageHelper</span> <span class="hljs-variable">helper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MimeMessageHelper</span>(message,<span class="hljs-literal">true</span>);<br>            helper.setFrom(from);<br>            helper.setTo(to);<br>            helper.setSubject(subject);<br>            helper.setText(context,<span class="hljs-literal">true</span>);<br>            <span class="hljs-comment">//添加附件</span><br>            <span class="hljs-type">File</span> <span class="hljs-variable">f1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;src/main/resources/111.jpg&quot;</span>);<br>            helper.addAttachment(<span class="hljs-string">&quot;图片.jpg&quot;</span>,f1);<br>            javaMailSender.send(message);<br>        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h2><ul>
<li>同步消息</li>
<li>异步消息<ul>
<li>企业级应用中广泛使用的三种异步消息传递技术<ul>
<li>JMS(Java message Service):一个规范，等同于JDBC规范，提供了与消息服务相关的API接口   <strong>规范消息相关的API</strong><ul>
<li>JSM消息模型<ul>
<li>peer-2-peer:<strong>点对点模型</strong>，消息发送到一个队列中，队列保存消息。队列的消息只能被一个消费者消费，或超时</li>
<li>publish-subscribe:发布订阅模型，消息可以被多个消费者消费，生产者和消费者完全独立，不需要感知对方的存在</li>
</ul>
</li>
</ul>
</li>
<li>AMQP(advanced message queuing protocol):一种协议(高级消息协议，也是消息代理规范)<strong>规范了网络交换的数据格式</strong>，兼容<strong>JMS</strong>  <strong>规范消息传递的格式</strong><ul>
<li>优点：兼容跨平台性，服务器供应商，生产者，消费者可以使用不同的语言实现</li>
<li>AMQP消息模型<ul>
<li>direct exchange</li>
<li>fanout exchange</li>
<li>topic exchange</li>
<li>headers exchange</li>
<li>system exchange</li>
</ul>
</li>
<li>AMQP消息种类: byte[]  字节数组类型</li>
<li>AMQP实现：RabbitMQ,StormMQ,RocketMQ</li>
</ul>
</li>
<li>MQIT(Message Queueing Telemetry Transport)消息队列遥测传输，<strong>专为小设备设计</strong>，是物联网(IOT)生态系统中主要成分之一</li>
<li>Kafka:一种高吞吐量的分布式发布订阅消息系统，提供实时消息功能  </li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><ul>
<li>RabbitMQ</li>
<li>StormMQ</li>
<li>RocketMQ</li>
<li>Kafka</li>
</ul>
<h3 id="Springboot-整合ActiveMQ"><a href="#Springboot-整合ActiveMQ" class="headerlink" title="Springboot 整合ActiveMQ"></a>Springboot 整合ActiveMQ</h3><h4 id="加入activemq坐标"><a href="#加入activemq坐标" class="headerlink" title="加入activemq坐标"></a>加入activemq坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--activemq--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="配置activemq"><a href="#配置activemq" class="headerlink" title="配置activemq"></a>配置activemq</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment"># 配置默认的服务地址</span><br>  <span class="hljs-attr">activemq:</span><br>    <span class="hljs-attr">broker-url:</span> <span class="hljs-string">tcp://localhost:61616</span><br>  <span class="hljs-comment"># 配置默认保存位置</span><br>  <span class="hljs-attr">jms:</span><br>    <span class="hljs-comment"># 开启true 设置发布订阅模型  false为点对点模型</span><br>    <span class="hljs-attr">pub-sub-domain:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">template:</span><br>      <span class="hljs-attr">default-destination:</span> <span class="hljs-string">itheima</span><br></code></pre></td></tr></table></figure>

<h4 id="使用JmsMessagingTemplate对象进行操作"><a href="#使用JmsMessagingTemplate对象进行操作" class="headerlink" title="使用JmsMessagingTemplate对象进行操作"></a>使用JmsMessagingTemplate对象进行操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageServiceActivemqImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JmsMessagingTemplate jmsMessagingTemplate;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;待发送的短信已纳入处理队列：id = &quot;</span>+id);<br>        <span class="hljs-comment">// 设置存放地址名称</span><br>        jmsMessagingTemplate.convertAndSend(<span class="hljs-string">&quot;order.queue.id&quot;</span>,id);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 在对应地址取出数据</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> jmsMessagingTemplate.receiveAndConvert(<span class="hljs-string">&quot;order.queue.id&quot;</span>,String.class);<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务id = &quot;</span>+id);<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="定义listener-自动处理消息队列"><a href="#定义listener-自动处理消息队列" class="headerlink" title="定义listener 自动处理消息队列"></a>定义listener 自动处理消息队列</h4><ul>
<li> @JmsListener(destination = “order.queue.id”) @JmsListener注解指定自动解决哪里位置的消息</li>
<li> @SendTo 自动处理完后， 将方法的返回值 发送到指定的其他队列中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> &#123;<br><br>    <span class="hljs-comment">//加上JmsListener会直接在接收到信息任务后直接处理，不需要手动进行处理</span><br>    <span class="hljs-meta">@JmsListener(destination = &quot;order.queue.id&quot;)</span><br>    <span class="hljs-meta">@SendTo(&quot;order.queue.other.id&quot;)</span>  <span class="hljs-comment">// 自动处理完后， 将方法的返回值 发送到指定的其他队列中</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">receive</span><span class="hljs-params">(String id)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务id = &quot;</span>+id);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;new:&quot;</span> + id;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><ul>
<li>RabbitMQ基于Erlang语编写，需要安装Erlang</li>
<li>Erlang<ul>
<li>需要下载</li>
<li>安装完成后重启电脑</li>
</ul>
</li>
<li>环境变量配置<ul>
<li>ERLANG_HOME</li>
<li>PATH</li>
</ul>
</li>
</ul>
<h4 id="安装RabbitMQ"><a href="#安装RabbitMQ" class="headerlink" title="安装RabbitMQ"></a>安装RabbitMQ</h4><ul>
<li>官网下载：傻瓜式安装</li>
</ul>
<h5 id="启动RabbitMQ"><a href="#启动RabbitMQ" class="headerlink" title="启动RabbitMQ"></a>启动RabbitMQ</h5><ul>
<li><p>管理员权限启动，在目录下启用cmd输入:rabbitmq-service.bat start</p>
</li>
<li><p>停止服务：rabbitmq-service.bat stop</p>
</li>
</ul>
<h5 id="开启RabbitMQ可视化界面"><a href="#开启RabbitMQ可视化界面" class="headerlink" title="开启RabbitMQ可视化界面"></a>开启RabbitMQ可视化界面</h5><ul>
<li>使用插件形式<ul>
<li>打开插件：rabbitmq-plugins.bat  enable rabbitmq_management</li>
<li>使用localhost：15672访问可视化界面</li>
<li>登录账号和密码：guest</li>
</ul>
</li>
</ul>
<h3 id="springboot整合Rabbitmq-直连交换机模式"><a href="#springboot整合Rabbitmq-直连交换机模式" class="headerlink" title="springboot整合Rabbitmq 直连交换机模式"></a>springboot整合Rabbitmq 直连交换机模式</h3><p>配置顺序基本相同</p>
<ul>
<li>使用web形式产生消息队列信息</li>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/order/1">http://localhost:8080/order/1</a></li>
</ul>
<h4 id="导入坐标"><a href="#导入坐标" class="headerlink" title="导入坐标"></a>导入坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--rabbitMQ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="配置rabbitmq"><a href="#配置rabbitmq" class="headerlink" title="配置rabbitmq"></a>配置rabbitmq</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span> <span class="hljs-comment"># 对外的服务端口为5672 管理端口为15672</span><br></code></pre></td></tr></table></figure>

<h4 id="定义消息队列-交换机-绑定"><a href="#定义消息队列-交换机-绑定" class="headerlink" title="定义消息队列 交换机 绑定"></a>定义消息队列 交换机 绑定</h4><ul>
<li>一个交换机可以绑定多个队列 处理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitConfigDirect</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 设置队列</span><br><span class="hljs-comment">     * Queue里的三个参数配置</span><br><span class="hljs-comment">     * durable:是否持久化 默认为false</span><br><span class="hljs-comment">     * exclusive:是否是当前连接专用 连接关闭后队列删除  默认为false</span><br><span class="hljs-comment">     * autoDelete:是否自动删除 当上生产者或消费者不再使用此队列 自动删除  默认为true</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">directQueue</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//设置消息队列名称</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">&quot;direct_queue&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 设置交换机</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">directExchange</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//设置交换机名称</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(<span class="hljs-string">&quot;directExchange&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 绑定消息队列与交换机 起名字为direct</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingDirect</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> BindingBuilder.bind(directQueue()).to(directExchange()).with(<span class="hljs-string">&quot;direct&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="生产与消费消息（direct）"><a href="#生产与消费消息（direct）" class="headerlink" title="生产与消费消息（direct）"></a>生产与消费消息（direct）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageRabbitmqDirectImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageService</span> &#123;<br><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AmqpTemplate amqpTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;待发送的短信已纳入处理队列(rabbitmq):id = &quot;</span>+id);<br>        amqpTemplate.convertAndSend(<span class="hljs-string">&quot;directExchange&quot;</span>,<span class="hljs-string">&quot;direct&quot;</span>,id);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="使用消息监听器对消息队列进行监听"><a href="#使用消息监听器对消息队列进行监听" class="headerlink" title="使用消息监听器对消息队列进行监听"></a>使用消息监听器对消息队列进行监听</h4><ul>
<li>当有两个或多个监听器监听一个消息队列时，两个监听器是轮换监听</li>
<li>安装字符串排序监听</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ClassName</span>: MessageListener</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>: mafangnian</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span>: 2022/7/15 22:30</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Blog</span>: null</span><br><span class="hljs-comment"> * 当有两个监听器监听一个消息队列时，两个监听器是轮换监听</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> &#123;<br><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;direct_queue&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(String id)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务(rabbitmq direct)id = &quot;</span>+id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="springboot整合Rabbitmq-主题交换机模式"><a href="#springboot整合Rabbitmq-主题交换机模式" class="headerlink" title="springboot整合Rabbitmq 主题交换机模式"></a>springboot整合Rabbitmq 主题交换机模式</h3><h4 id="定义消息队列"><a href="#定义消息队列" class="headerlink" title="定义消息队列"></a>定义消息队列</h4><p>可以采用模糊匹配的方式匹配消息队列进行监听器处理</p>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/9.png" srcset="/img/loading.gif" lazyload alt="消息队列"></p>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/10.png" srcset="/img/loading.gif" lazyload alt="匹配规则"></p>
<h4 id="生产与消费消息（topic）"><a href="#生产与消费消息（topic）" class="headerlink" title="生产与消费消息（topic）"></a>生产与消费消息（topic）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageRabbitmqTopicImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AmqpTemplate amqpTemplate;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;待发送的短信已纳入处理队列(rabbitmq topic):id = &quot;</span>+id);<br>        amqpTemplate.convertAndSend(<span class="hljs-string">&quot;topicExchange&quot;</span>,<span class="hljs-string">&quot;topic&quot;</span>,id);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="消息监听器监听消息队列"><a href="#消息监听器监听消息队列" class="headerlink" title="消息监听器监听消息队列"></a>消息监听器监听消息队列</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> &#123;<br><br>    <span class="hljs-comment">//监听一号消息队列 topic_queue</span><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;topic_queue&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive</span><span class="hljs-params">(String id)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务(rabbitmq topic)id = &quot;</span>+id);<br>    &#125;<br>    <br>    <span class="hljs-comment">//监听二号消息队列 topic_queue2</span><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;topic_queue2&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">receive1</span><span class="hljs-params">(String id)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务(rabbitmq topic)id = &quot;</span>+id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h4><p>当发消息队列的时候(routingKey)起名遵循了两个消息队列的(routingKey)的模糊条件时，设置了监听器的消息队列匹配成功之后，均执行监听器操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(String id)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;待发送的短信已纳入处理队列(rabbitmq topic):id = &quot;</span>+id);<br>    amqpTemplate.convertAndSend(<span class="hljs-string">&quot;topicExchange&quot;</span>,<span class="hljs-string">&quot;topic.id.orders&quot;</span>,id);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingTopic</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(topicQueue()).to(topicExchange()).with(<span class="hljs-string">&quot;topic.*.orders&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingTopic2</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> BindingBuilder.bind(topicQueue()).to(topicExchange()).with(<span class="hljs-string">&quot;topic.id.*&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h3><h4 id="安装：解压缩"><a href="#安装：解压缩" class="headerlink" title="安装：解压缩"></a>安装：解压缩</h4><ul>
<li>默认服务端口：9876</li>
<li>环境变量配置：ROCKETMQ_HOME</li>
<li>PATH</li>
<li>NAMESRV_ADDR(建议):127.0.0.1:9876</li>
</ul>
<h4 id="启动命名服务器和broker"><a href="#启动命名服务器和broker" class="headerlink" title="启动命名服务器和broker"></a>启动命名服务器和broker</h4><ul>
<li>配置环境变量完成后直接双击文件<ul>
<li>命名服务器：mqnamesrv.cmd</li>
<li>broker服务器：mqbroker.cmd</li>
</ul>
</li>
<li>启动服务器</li>
</ul>
<h4 id="测试服务器"><a href="#测试服务器" class="headerlink" title="测试服务器"></a>测试服务器</h4><p>recketmq自带测试程序 需要使用测试的话，在包路径下找对应的测试类</p>
<ul>
<li>使用tools org.apache.rocketmq.example.quickstart.Producer （产生若干条消息） 如果服务器有问题，则无法产生</li>
<li>使用tools org.apache.rocketmq.example.quickstart.Consumer 消费消息</li>
</ul>
<h4 id="springboot整合rocketmq"><a href="#springboot整合rocketmq" class="headerlink" title="springboot整合rocketmq"></a>springboot整合rocketmq</h4><p>需要启动rocketmq服务器</p>
<h5 id="导入坐标-1"><a href="#导入坐标-1" class="headerlink" title="导入坐标"></a>导入坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--rocketmq--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.rocketmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="配置rocketmq"><a href="#配置rocketmq" class="headerlink" title="配置rocketmq"></a>配置rocketmq</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">rocketmq:</span><br>  <span class="hljs-attr">name-server:</span> <span class="hljs-string">localhost:9876</span><br>  <span class="hljs-comment"># 设置生产者所属组</span><br>  <span class="hljs-attr">producer:</span><br>    <span class="hljs-attr">group:</span> <span class="hljs-string">group_rocketmq</span><br></code></pre></td></tr></table></figure>

<h5 id="设置发送消息对象-RocketMQTemplate"><a href="#设置发送消息对象-RocketMQTemplate" class="headerlink" title="设置发送消息对象 RocketMQTemplate"></a>设置发送消息对象 RocketMQTemplate</h5><p>生产消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageServiceRocketmqImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RocketMQTemplate rocketMQTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;待发送的短信已纳入处理队列(rocketmq):id = &quot;</span>+id);<br>        <span class="hljs-comment">// 同步消息</span><br><span class="hljs-comment">//        rocketMQTemplate.convertAndSend(&quot;order_id&quot;,id);</span><br>        <br>        <span class="hljs-comment">//异步消息产生之后的回调操作 告诉你消息执行情况</span><br>        <span class="hljs-type">SendCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendCallback</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(SendResult sendResult)</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;消息发送成功！&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onException</span><span class="hljs-params">(Throwable throwable)</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;消息发送失败！&quot;</span>);<br>            &#125;<br>        &#125;;<br>        <span class="hljs-comment">//异步消息</span><br>        <span class="hljs-comment">//三个参数 1.发送的位置即主题名称 2.发送的消息 3.发送后的结果</span><br>        rocketMQTemplate.asyncSend(<span class="hljs-string">&quot;order_id&quot;</span>,id,callback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="配置监听器-消费消息"><a href="#配置监听器-消费消息" class="headerlink" title="配置监听器 消费消息"></a>配置监听器 消费消息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-comment">//设置主题名称 消费者所属组</span><br><span class="hljs-comment">//设置消费者 必须和生产者一个组才能匹配 消费消息 consumerGroup = &quot;group_rocketmq&quot;</span><br><span class="hljs-meta">@RocketMQMessageListener(topic = &quot;order_id&quot;,consumerGroup = &quot;group_rocketmq&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;String&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务(rocketmq) = &quot;</span>+id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><ul>
<li>消息中间件</li>
</ul>
<p>安装解压缩：windows建议使用2.x之类的版本 3.x的版本存在bug</p>
<h4 id="启动Kafka服务器"><a href="#启动Kafka服务器" class="headerlink" title="启动Kafka服务器"></a>启动Kafka服务器</h4><ul>
<li><p>在Kafka的bin目录下的windows里启动cmd</p>
<ul>
<li>先启动注册器，在启动命名服务器</li>
</ul>
</li>
<li><p>启动zookeeper(注册器)</p>
<ul>
<li>zookeeper-server-start.bat ../../config/zookeeper.properties (需要指定启动的配置文件 在config目录下)</li>
<li>默认端口：2181</li>
</ul>
</li>
<li><p>启动kafka</p>
<ul>
<li>kafka-server-start.bat ../../config/server.properties (同样指定配置文件 在config目录下) </li>
<li>默认端口：9092</li>
</ul>
</li>
</ul>
<h4 id="测试kafka服务器"><a href="#测试kafka服务器" class="headerlink" title="测试kafka服务器"></a>测试kafka服务器</h4><ul>
<li>需要自己创建topic来测试<ul>
<li>创建topic: kafka-topics.bat –zookeeper 127.0.0.1:2181 –create –replication-factor 1 –partitions 1 –topic itheima（最后一个参数设置topic名称）</li>
</ul>
</li>
<li>查看topic<ul>
<li>kafka-topics.bat –zookeeper 127.0.0.1:2181 –list</li>
</ul>
</li>
<li>测试<ul>
<li>生产者功能测试<ul>
<li>kafka-console-producer.bat –broker-list localhost:9092 –topic itheima</li>
</ul>
</li>
<li>消费者功能测试<ul>
<li>kafka-console-consumer.bat  –bootstrap-server localhost:9092 –topic itheima –from-beginning</li>
</ul>
</li>
</ul>
</li>
<li>删除topic<ul>
<li>kafka-topics.bat –delete –zookeeper localhost:2181 –topic itheima</li>
</ul>
</li>
</ul>
<h4 id="springboot整合kafka"><a href="#springboot整合kafka" class="headerlink" title="springboot整合kafka"></a>springboot整合kafka</h4><h5 id="导入坐标-2"><a href="#导入坐标-2" class="headerlink" title="导入坐标"></a>导入坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--kafka--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.kafka<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-kafka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h5 id="配置地址信息"><a href="#配置地址信息" class="headerlink" title="配置地址信息"></a>配置地址信息</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">kafka:</span><br>   <span class="hljs-comment"># 指定访问服务器地址</span><br>    <span class="hljs-attr">bootstrap-servers:</span> <span class="hljs-string">localhost:9092</span><br>    <span class="hljs-attr">consumer:</span><br>      <span class="hljs-comment"># 配置消费者所属组</span><br>      <span class="hljs-attr">group-id:</span> <span class="hljs-string">order</span><br></code></pre></td></tr></table></figure>



<h5 id="生产消息"><a href="#生产消息" class="headerlink" title="生产消息"></a>生产消息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageServiceKafkaImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String,String&gt; kafkaTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">SendMessage</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;待发送的短信已纳入处理队列(kafka):id = &quot;</span>+id);<br>        kafkaTemplate.send(<span class="hljs-string">&quot;itheima&quot;</span>,id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="监听器消费消息"><a href="#监听器消费消息" class="headerlink" title="监听器消费消息"></a>监听器消费消息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageListener</span> &#123;<br><br>    <span class="hljs-meta">@KafkaListener(&quot;itheima&quot;)</span> <span class="hljs-comment">//指定</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(ConsumerRecord&lt;String,String&gt; record)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;已完成短信发送业务id(kafka) = &quot;</span> + record.value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><h3 id="监控的意义"><a href="#监控的意义" class="headerlink" title="监控的意义"></a>监控的意义</h3><ul>
<li>监控服务状态是否宕机</li>
<li>监控服务运行指标(内存，虚拟机，线程，请求等)</li>
<li>监控日志</li>
<li>管理服务(服务下线)</li>
</ul>
<h3 id="监控的实施方式"><a href="#监控的实施方式" class="headerlink" title="监控的实施方式"></a>监控的实施方式</h3><ul>
<li>显示监控信息的服务器：用于获得服务信息，并显示对应的信息</li>
<li>运行的服务：启动时主动上报，告知监控服务器自己需要受到监控</li>
</ul>
<h3 id="可视化监控平台"><a href="#可视化监控平台" class="headerlink" title="可视化监控平台"></a>可视化监控平台</h3><ul>
<li><strong>Spring Boot Admin</strong>，开源社区项目，用于管理和监控springboot应用程序。客户端注册到服务端，通过HTTP请求方式，服务端定期从客户端获取对应的信息，并提供ui界面展示对应信息</li>
<li>平台版本必须和springboot版本相一致</li>
</ul>
<p>做成web形式，使用可视化界面查看 配置个web程序端口</p>
<ul>
<li>在服务端开启监控服务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//开启监控服务</span><br><span class="hljs-meta">@EnableAdminServer</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot21AdminServerApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(Springboot21AdminServerApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>创建Admin服务端 对应坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>配置客户端</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>de.codecentric<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>客户端匹配服务端</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">boot:</span><br>    <span class="hljs-attr">admin:</span><br>      <span class="hljs-attr">client:</span><br>        <span class="hljs-comment"># 谁来监控</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">http://localhost:8080</span><br><span class="hljs-attr">management:</span><br>  <span class="hljs-attr">endpoint:</span><br>    <span class="hljs-attr">health:</span><br>      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span><br>  <span class="hljs-attr">endpoints:</span><br>    <span class="hljs-attr">web:</span><br>      <span class="hljs-comment"># 打开所有可查看的配置</span><br>      <span class="hljs-attr">exposure:</span><br>        <span class="hljs-attr">include:</span> <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="监控原理-—–Actuator"><a href="#监控原理-—–Actuator" class="headerlink" title="监控原理 —–Actuator"></a>监控原理 —–Actuator</h3><ul>
<li>Actuator提供了SpringBoot生产就绪功能，通过端点的配置与访问，获取端点信息 </li>
<li>端点描述了一组监控信息，SpringBoot提供了多个内置端点，也可以根据需要自定义端点信息 </li>
<li>访问当前应用所有端点信息：/actuator 访问端点详细信息：/actuator/端点名称 </li>
</ul>
<h3 id="端点暴露"><a href="#端点暴露" class="headerlink" title="端点暴露"></a>端点暴露</h3><p>./springboot开发实用篇/9</p>
<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/11.png" srcset="/img/loading.gif" lazyload alt="暴露端点功能"></p>
<h4 id="Info端点加载数据"><a href="#Info端点加载数据" class="headerlink" title="Info端点加载数据"></a>Info端点加载数据</h4><ul>
<li>静态数据</li>
<li>动态数据</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># 设置端点里内容 info 设置内容</span><br><span class="hljs-attr">info:</span><br>  <span class="hljs-attr">appName:</span> <span class="hljs-string">@02@</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-string">@9.9@</span><br>  <span class="hljs-attr">company:</span> <span class="hljs-string">Good</span> <span class="hljs-string">Company</span><br>  <span class="hljs-attr">author:</span> <span class="hljs-string">XD</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 通过spring容器设置数据</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InfoContributor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contribute</span><span class="hljs-params">(Info.Builder builder)</span> &#123;<br>        builder.withDetail(<span class="hljs-string">&quot;runTime&quot;</span>,System.currentTimeMillis());<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/12.png" srcset="/img/loading.gif" lazyload alt="Spring Boot Admin 可视化界面"></p>
<h4 id="health端点数据自定义"><a href="#health端点数据自定义" class="headerlink" title="health端点数据自定义"></a>health端点数据自定义</h4><p>继承实现数据自定义</p>
<p><strong>状态的设置，如果状态不是为up则会影响最终实例的状态</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractHealthIndicator</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHealthCheck</span><span class="hljs-params">(Health.Builder builder)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        builder.withDetail(<span class="hljs-string">&quot;runTime&quot;</span>,System.currentTimeMillis());<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">infoMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        infoMap.put(<span class="hljs-string">&quot;buildTime&quot;</span>,<span class="hljs-string">&quot;2006&quot;</span>);<br>        builder.withDetails(infoMap);<br>        <span class="hljs-comment">//设置状态</span><br>        builder.up();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/07/16/springboot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/13.png" srcset="/img/loading.gif" lazyload alt="自定义health指标"></p>
<h4 id="性能指标自定义"><a href="#性能指标自定义" class="headerlink" title="性能指标自定义"></a>性能指标自定义</h4><p>执行了多少次结果会在可视化界面上展示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Counter counter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">BookServiceImpl</span><span class="hljs-params">(MeterRegistry meterRegistry)</span>&#123;<br><br>    counter = meterRegistry.counter(<span class="hljs-string">&quot;用户操作付费次数:&quot;</span>)<br>&#125;<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Integer id)</span> &#123;<br>    <span class="hljs-comment">//每次执行删除操作相当于执行了一次付费操作</span><br>    counter.increment();<br>    <span class="hljs-keyword">return</span> bookDao.deleteById(id) &gt; <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="自定义监控指标"><a href="#自定义监控指标" class="headerlink" title="自定义监控指标"></a>自定义监控指标</h4><h5 id="自定义端点"><a href="#自定义端点" class="headerlink" title="自定义端点"></a>自定义端点</h5><p>通过<a target="_blank" rel="noopener" href="http://localhost:8080/actuator/pay">http://localhost:8080/actuator/pay</a> 访问</p>
<p>在可视化界面 <strong>Spring Boot Admin</strong>上可以查看</p>
<p>在使用了这个链接之后页面显示return回来的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Endpoint(id = &quot;pay&quot;,enableByDefault = true)</span> <span class="hljs-comment">//通过id访问</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">payEndPoint</span> &#123;<br>    <span class="hljs-meta">@ReadOperation</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getPay</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">payMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        payMap.put(<span class="hljs-string">&quot;lever 1&quot;</span>,<span class="hljs-number">100</span>);<br>        payMap.put(<span class="hljs-string">&quot;lever 2&quot;</span>,<span class="hljs-number">50</span>);<br>        payMap.put(<span class="hljs-string">&quot;lever 3&quot;</span>,<span class="hljs-number">10</span>);<br>        <span class="hljs-keyword">return</span> payMap;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="总结：部分技术尚未撞我，大抵只是通过springboot整合了解，对各个模块有了更深层次的印象；可以加快速度学习，但是笔记总要回顾，需要不定时会看，巩固基础"><a href="#总结：部分技术尚未撞我，大抵只是通过springboot整合了解，对各个模块有了更深层次的印象；可以加快速度学习，但是笔记总要回顾，需要不定时会看，巩固基础" class="headerlink" title="总结：部分技术尚未撞我，大抵只是通过springboot整合了解，对各个模块有了更深层次的印象；可以加快速度学习，但是笔记总要回顾，需要不定时会看，巩固基础"></a>总结：部分技术尚未撞我，大抵只是通过springboot整合了解，对各个模块有了更深层次的印象；可以加快速度学习，但是笔记总要回顾，需要不定时会看，巩固基础</h2><h1 id="开发实用篇告一段落"><a href="#开发实用篇告一段落" class="headerlink" title="开发实用篇告一段落"></a>开发实用篇告一段落</h1>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/springboot/">#springboot</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>springboot开发实用篇</div>
      <div>http://example.com/2022/07/16/springboot开发实用篇/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>MFN</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年7月16日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/07/04/Springboot%E8%BF%90%E7%BB%B4%E5%AE%9E%E7%94%A8%E7%AF%87/" title="Springboot运维实用篇">
                        <span class="hidden-mobile">Springboot运维实用篇</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
